ready = ->
  $('body').prepend('<div id="fb-root"></div>')

  $.ajax
    url: "#{window.location.protocol}//connect.facebook.net/en_US/all.js"
    dataType: 'script'
    cache: true

  # enable chosen js
  $('#ingredient_selector').chosen
    no_results_text: 'No ingredients matched'
    # width: '250px'

  $('#tag_selector').chosen
    no_results_text: 'No tags matched'

  # $('#sign_in').click (e) ->
  #   e.preventDefault()
  #   FB.login (response) ->
  #     window.location = '/auth/facebook/callback?' + $.param({ signed_request: response.authResponse.signedRequest }) if response.authResponse

  # $('#sign_out').click (e) ->
  #   FB.getLoginStatus (response) ->
  #     FB.logout() if response.authResponse
  #   true


window.fbAsyncInit = ->
  FB.init(appId: '<%= ENV["FACEBOOK_APP_ID"] %>', cookie: true)

  $('#sign_in').click (e) ->
    e.preventDefault()
    FB.login (response) ->
      window.location = '/auth/facebook/callback?' + $.param({ signed_request: response.authResponse.signedRequest }) if response.authResponse

  # $('#sign_out').click (e) ->
  #   FB.getLoginStatus (response) ->
  #     FB.logout() if response.authResponse
  #   true


$(document).ready(ready)
# $(document).ready(window.fbAsyncInit)
$(document).on('page:load', ready)
$(document).on('page:load', window.fbAsyncInit)